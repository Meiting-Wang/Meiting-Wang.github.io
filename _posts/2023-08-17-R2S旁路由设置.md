---
title: R2S 旁路由设置
permalink: /dab639369b8d21f13fc0ac9b37b62d43
tags: fq
---

我们魔法上网一般使用各个软件进行，但是，如果是以家庭为体系，想让家庭 wifi 下的所有设备都能够魔法上网的话，这时就需要软路由出场了。这里以 R2S 软路由为例，介绍旁路由设置的过程。

<!--more-->

## 硬路由设置

硬路由就是我们常见的带发射wifi信号的路由器。我们使用的硬路由的型号为“**小米 Redmi 路由器 AC2100**”。而本篇文章标题所提到的R2S就是入门级软路由了，而其在500M宽带及以下都不会比较大的限制。

之所以将R2S作为旁路由而不是主路由，是因为其对家庭核心网络环境的入侵性不会太大（当然，在旁路由的设置中又有入侵性设置和非入侵性设置两种）。**如果哪一天软路由出问题了，我们依旧可以使用硬路由 + v2rayN 的方式上网**。而如果我们使用的是将R2S作为主路由的形式，则当其出问题时，整个家庭网络都将瘫痪。

下面详细说一下**有关硬路由的详细设置**（以联通PPPoE为例）：
- 用网线连接光猫的千兆网口与小米路由器的wan口
- 启动小米路由器，并用手机或电脑通过有线或无线连接到路由器
- 通过 192.168.31.1 或 miwifi.com 进入小米路由器后端
- 进入**常用设置**>**安全中心**，设置管理员密码
- 进入**常用设置**>**上网设置**，输入联通宽带的[[宽带信息|账户与密码]]进行PPPoE拨号上网
- 进入**常用设置**>**Wi-Fi设置**，设置2.4G wifi 与 5G wifi 的名称、密码与隐藏与否，并启用**MU-MIMO/Beamforming**
- 进入**高级设置**>**QoS智能限速**，关闭**QoS智能分配**
- 此时，小米路由器有线和wifi就都能上网了

**这里值得注意的是**，小米路由器在**常用设置**>**局域网设置**中，默认开启了DHCP服务，所以其会为连接该路由器下各个终端分配设定区间内的ip地址（均在 192.168.31.xxx 网段下）。当然，在这里我们也能发现该路由器的后台ip地址为 192.168.31.1。

到此为止，在不会用到软路由的情况下，以上设置流程即为普通路由器上网设置的全部流程。

## 软路由设置

**我的软路由为R2S，刷机并启动后设置如下**：
- 先用一根网线连接硬路由的LAN口和软路由的LAN口
- 按照以下图片设置Windows电脑端的网络，以使得我们能访问R2S的后台（192.168.2.1）。这时我们将上不了网，也登不了小米路由器的后台，因为我们手动设置的IP地址与小米路由器（192.168.31.1）不在同一个网段。
![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206270145931.png)
- 进入R2S后台（192.168.2.1）
- 进入**系统**>**管理权**，重置主机密码
- 进入**网络**>**接口**>**LAN口**>**修改**>**基本设置**，找到ipv4地址一栏，并将其改为与小米路由器在同一网段的地址（如 192.168.31.2）。此时我们将无法再访问R2S后台。
- 回到前面的windows网络设置中，将ip设置再由手动设置改为自动（DHCP）。此时，由于R2S与小米路由器在同一个网段，则我们既可以访问R2S新设置的后台（192.168.31.2），也可以上网了。 
- 登陆到R2S新指定的后台（192.168.31.2），进入**网络**>**接口**>**LAN口**>**修改**，进行如下图片的设置：

![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206271808683.png)

![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206271809383.png)
- 完成下面的防火墙设置：
![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206271835924.png)


**设置的总体思想**：
- 旁路由必须和主路由在同一网段
- 旁路由的网关必须指向主路由
- 防火墙开启IP动态伪装

**另外在R2S中要注意的是**：
- 我们可以进入系统>备份，进行配置的备份、配置的恢复、恢复到出厂设置、刷写新的固件（.gz结尾的固件不需要解压）等操作。
- 进入网络>接口，我们会发现有一个WAN6接口，这个接口的含义如下：
	- 如果你是光猫拨号，则会在全局网络选项显示获取的ipv6地址
	- 如果使用R2S拨号，则这个东西就没什么用了
	- 最终的结论是，嫌碍眼你就删，不删也没关系

## 配置R2S中的ShadowSocksR Plus+服务
将自己的服务器节点配置进去，选择好主服务器和运行模式，点击“保存&应用”即可。


## 终端设置
### windows设置

![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206280136359.png)

> 1. 这里的网关指向了旁路由。我们知道旁路由的网关指向了主路由，于是之后上网的数据路径为 windows>旁路由>主路由>运营商。
> 2. 如果首选DNS写的是主路由的ip地址，则会出现“raw.githubusercontent.com”网段无法上网的情况（对于下面的手机也是同样的情况）。

### Oppo手机设置
![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206280140302.png)

### 小结
到此为止，只要按照上面手动设置了ip地址的终端，都可以实现以前面ShadowSocksR Plus+所设置的运行模式进行上网（**模式：终端的网关指向旁路由>旁路由的网关指向主路由>主路由连接着运营商**。下称科学上网）。而对于没有手动设置ip地址的终端，其也能无障碍的访问国内网站，就像软路由不存在一样（**模式：终端的网关指向主路由>主路由连接着运营商**）。这个模式也被称为**非入侵模式**，即家庭核心网络（运营商-光猫-主路由）没有受到软路由的任何影响。换个说法，如果哪天软路由挂了，也不会影响到我们正常上国内的网（重新将ip地址的获取方式改为DHCP即可）。


## 入侵模式
对于**非入侵模式**，它也有缺点，就是每个连接到该局域网的终端，都需要手动设置ip地址，才能实现科学上网。那么有没有一种方式使得连接上该局域网的终端都自动实现科学上网？答案是有的。那这个就被称为是入侵模式了，即会对家庭核心网络（运营商-光猫-主路由）造成影响。换个说法，如果哪天软路由挂了，则整个局域网都瘫痪了。

在前面的基础上，这里阐述一下接下来的设置：
- 登陆到R2S的后台（192.168.31.2），进入**网络**>**接口**>**LAN口**>**修改**，进行如下图片的设置：
![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206280229218.png)

![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206280230526.png)

- 进入主路由（小米路由器）的后台（192.168.31.1），进入**常规设置**>**局域网设置**，进行如下图片的设置：
![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206280233893.png)
- 将上面终端获取ip的方式改为DHCP，并刷新网络，即可实现科学上网。
- 对于其他后来连接上该局域网的终端，无需任何其他的额外设置，即可实现科学上网。

## 其他问题
### 如何查看局域网下所有设备的ip地址
如前面所说，我们在手动设置ip地址时，需要不与同局域网下其他设备的ip地址发生冲突。那么我们该如何查看该局域网下所有设备对应的ip地址呢？

**方法一：通过小米路由器后台**

![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206271939802.png)

**方法二：R2S后台**

![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206271940375.png)

### 有线连接的windows系统如何刷新网络
![](https://cdn.jsdelivr.net/gh/Meiting-Wang/pictures/picgo/picgo-202206280252391.png)


## 7 参考资料
- [重要-youtube-向北-N1盒子、R2S等设备刷openwrt后做旁路由的两种设置方法（超详细），全家设备翻墙，YouTube 高清视频秒开（cc字幕）](https://www.youtube.com/watch?v=P6NdEjycHhw)
- [重要-youtube-洋葱-软路由做旁路由三步搞定！openwrt软路由 R2S R4S openwrt软路由科学上网设置](https://www.youtube.com/watch?v=w7rwNF2Q3lM&t=9s)
- [youtube-洋葱-软路由二级路由旁路由科学上网谁最快？ R2S R4S 软路由openwrt极限速度测试](https://www.youtube.com/watch?v=cFpj_IhZd84&t=11s)
- [youtube-洋葱-R2S软路由销量之王！R2S安装openwrt攻略 openwrt软路由设置](https://www.youtube.com/watch?v=ZCmbbnIBD78&t=36s)
- [网关是什么](https://m.elecfans.com/article/823568.html)
- [好看-路由器基础设置经典教程：DHCP功能的最详细介绍](https://haokan.baidu.com/v?pd=wisenatural&vid=7222462497338050003)
- [2023最新 软路由翻墙教程，软路由翻墙软件速度测试，r2s openwrt固件推荐|hello world设置科学上网方法](https://www.youtube.com/watch?v=jGudo0dc7vg)
- [DHDAXCW/NanoPi-R2S-rk3328](https://github.com/DHDAXCW/NanoPi-R2S-rk3328)